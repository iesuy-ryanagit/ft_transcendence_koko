<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test</title>
    <style>
        .response {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            white-space: pre-wrap; 
        }
        .error {
            background-color: #ffe6e6;
        }
        .success {
            background-color: #e6ffe6;
        }
    </style>
</head>
<body>

<h1>API Test</h1>

<!-- Signup Section -->
<h2>Signup</h2>
<input type="text" id="signup-username" placeholder="Username" required><br>
<input type="password" id="signup-password" placeholder="Password" required><br>
<button onclick="signup()">Signup</button>

<!-- Login Section -->
<h2>Login</h2>
<input type="text" id="login-username" placeholder="Username" required><br>
<input type="password" id="login-password" placeholder="Password" required><br>
<button onclick="login()">Login</button>

<!-- Profile Section -->
<h2>Profile</h2>
<button onclick="getProfile()">Get Profile</button>

<!-- Logout Section -->
<h2>Logout</h2>
<button onclick="logout()">Logout</button>

<!-- Display API Response -->
<h2>API Response</h2>
<div id="response-container" class="response">
    <p><strong>Status:</strong> <span id="status-code">N/A</span></p>
    <p><strong>Response:</strong> <span id="api-response">No response yet</span></p>
</div>

<script>
  const apiBase = 'http://localhost:8000/api/';

  // Function to make POST requests
  async function postData(url = '', data = {}) {
      console.log("Sending POST request to:", url); // Log request
      const response = await fetch(url, {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
      });

      const responseData = await response.json();
      console.log("Response Data:", responseData); // Log response
      updateResponseDisplay(response.status, responseData);
      return responseData;
  }

  // Function to make GET requests with JWT token
  async function getData(url = '') {
      const token = localStorage.getItem('access_token');
      console.log("Sending GET request to:", url); // Log request
      const response = await fetch(url, {
          method: 'GET',
          headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + token, // Send the JWT token in the header
          },
      });

      const responseData = await response.json();
      console.log("Response Data:", responseData); // Log response
      updateResponseDisplay(response.status, responseData);
      return responseData;
  }

  // Function to update the response status and content on the page
  function updateResponseDisplay(status, responseData) {
      document.getElementById('status-code').innerText = status;
      document.getElementById('api-response').innerText = JSON.stringify(responseData, null, 2);

      const responseContainer = document.getElementById('response-container');
      if (status >= 200 && status < 300) {
          responseContainer.classList.remove('error');
          responseContainer.classList.add('success');
      } else {
          responseContainer.classList.remove('success');
          responseContainer.classList.add('error');
      }
  }

  // Signup function
  async function signup() {
      const username = document.getElementById('signup-username').value;
      const password = document.getElementById('signup-password').value;

      const data = {
          username: username,
          password: password,
      };

      console.log("Signup button clicked"); // Log button click
      const response = await postData(apiBase + 'signup/', data);

      if (response && response.username) {
          alert('Signup successful!');
      } else {
          alert('Signup failed: ' + JSON.stringify(response));
      }
  }

  // Login function
  async function login() {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;

      const data = {
          username: username,
          password: password,
      };

      console.log("Login button clicked"); // Log button click
      const response = await postData(apiBase + 'login/', data);

      if (response) {
        //   localStorage.setItem('access_token', response.access_token); // Store JWT token
          alert('Login successful!');
      } else {
          alert('Login failed: ' + JSON.stringify(response));
      }
  }

  // Get profile function
  async function getProfile() {
      const response = await getData(apiBase + 'profile/');
      
      if (response && response.username) {
          alert('Profile retrieved: ' + JSON.stringify(response));
      } else {
          alert('Failed to retrieve profile: ' + JSON.stringify(response));
      }
  }

  // Logout function
  async function logout() {
      const response = await postData(apiBase + 'logout/', {});
      
      if (response && response.message) {
        //   localStorage.removeItem('access_token'); // Remove JWT token
          alert('Logged out successfully!');
      } else {
          alert('Logout failed: ' + JSON.stringify(response));
      }
  }
</script>

</body>
</html>
